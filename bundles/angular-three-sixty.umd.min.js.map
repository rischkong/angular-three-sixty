{"version":3,"sources":["angular-three-sixty.umd.js"],"names":["global","factory","exports","module","require","define","amd","ng","angularThreeSixty","core","this","ImageLoader","cache","prototype","load","url","_this","Promise","resolve","hasOwnProperty","image","Image","onload","src","Hammer","ThreeSixty","canvasElement","configuration","hotspotElements","angle","preDragAngle","canvas2dContext","getContext","imageLoader","window","onresize","images","getActiveImages","initialize","imageSet","startAngle","console","log","Error","containerElement","document","createElement","classList","add","CONTAINER_CLASS","parentElement","insertBefore","appendChild","initializeHotspots","initializeEventListeners","imageIndexes","getImageIndexesForCurrentAngle","targetSpriteIndex","then","drawAngle","targetImageIndex","updateConfiguration","forEach","hotspotElement","removeChild","updateImages","preload","imagesLoaded","length","bind","width","outerWidth","activeBreakpoint","Object","keys","sort","reverse","find","breakpoint","parseFloat","hotspots","hotspot","HOTSPOT_CLASS","innerText","text","top","style","left","push","hotSpotElement","showActiveHotspots","i","endAngle","HOTSPOT_ACTIVE_CLASS","remove","hammer","get","set","direction","DIRECTION_HORIZONTAL","threshold","on","onDrag","onDragStart","Math","round","angles","floor","anglesPerImage","imageIndex","loaded","_drawAngle","drawImage","height","requestAnimationFrame","e","adaptAngle","deltaX","distance","dx","ceil","speedFactor","innerWidth","tmpAngle","ThreeSixtyFactory","create","ThreeSixtyComponent","threeSixtyFactory","preloaded","EventEmitter","ngOnInit","threeSixty","nativeElement","getThreeSixtyConfiguration","preloadImages","ngOnChanges","changes","forcePreload","emit","decorators","type","Component","args","selector","styles","template","encapsulation","ViewEncapsulation","None","ctorParameters","propDecorators","Input","Output","ViewChild","ThreeSixtyModule","NgModule","declarations","providers","ɵa","defineProperty","value"],"mappings":"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","file":"angular-three-sixty.umd.min.js.map","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@angular/core')) :\n\ttypeof define === 'function' && define.amd ? define('angular-three-sixty', ['exports', '@angular/core'], factory) :\n\t(factory((global.ng = global.ng || {}, global.ng.angularThreeSixty = {}),global.ng.core));\n}(this, (function (exports,core) { 'use strict';\n\nvar ImageLoader = /** @class */ (function () {\r\n    function ImageLoader() {\r\n        /**\r\n         * @type {{[string]: Image}}\r\n         */\r\n        this.cache = {};\r\n    }\r\n    /**\r\n     * Load an image\r\n     *\r\n     * @param {string} url\r\n     * @returns {Promise<Image>}\r\n     */\r\n    ImageLoader.prototype.load = function (url) {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            if (_this.cache.hasOwnProperty(url)) {\r\n                return resolve(_this.cache[url]);\r\n            }\r\n            var image = new Image();\r\n            image.onload = function () {\r\n                _this.cache[url] = image;\r\n                resolve(image);\r\n            };\r\n            image.src = url;\r\n        });\r\n    };\r\n    return ImageLoader;\r\n}());\r\n\r\nvar Hammer = require('hammerjs');\r\nvar ThreeSixty = /** @class */ (function () {\r\n    /**\r\n     * @param {HTMLCanvasElement} canvasElement\r\n     * @param {ConfigurationInterface} configuration\r\n     */\r\n    function ThreeSixty(canvasElement, configuration) {\r\n        var _this = this;\r\n        this.canvasElement = canvasElement;\r\n        this.configuration = configuration;\r\n        /**\r\n         * @type {HTMLElement[]}\r\n         */\r\n        this.hotspotElements = [];\r\n        /**\r\n         * Angle of the current image\r\n         * Number between 0 and 360\r\n         *\r\n         * @type {number}\r\n         */\r\n        this.angle = 0;\r\n        /**\r\n         * Angle of the image before the drag process began\r\n         *\r\n         * @type {number}\r\n         */\r\n        this.preDragAngle = 0;\r\n        this.canvas2dContext = this.canvasElement.getContext('2d');\r\n        this.imageLoader = new ImageLoader();\r\n        window.onresize = function () { return _this.images = _this.getActiveImages(); };\r\n    }\r\n    /**\r\n     * Initialize the three sixty widget\r\n     *\r\n     * @param {ImageSetInterface} imageSet - Array of image sprites\r\n     * @param {number} startAngle - The initial angle to show (number between 0 and 360)\r\n     */\r\n    ThreeSixty.prototype.initialize = function (imageSet, startAngle) {\r\n        console.log('iamgeSet', imageSet);\r\n\r\n        var _this = this;\r\n        if (startAngle === void 0) { startAngle = 0; }\r\n        if (startAngle < 0 || startAngle > 360) {\r\n            throw new Error('The specified start angle must be between 0 and 360.');\r\n        }\r\n        this.angle = startAngle;\r\n        this.imageSet = imageSet;\r\n        this.images = this.getActiveImages();\r\n        // Wrap the canvas element\r\n        this.containerElement = document.createElement('div');\r\n        this.containerElement.classList.add(ThreeSixty.CONTAINER_CLASS);\r\n        this.canvasElement.parentElement.insertBefore(this.containerElement, this.canvasElement);\r\n        this.containerElement.appendChild(this.canvasElement);\r\n        this.initializeHotspots();\r\n        this.initializeEventListeners();\r\n        var imageIndexes = this.getImageIndexesForCurrentAngle();\r\n        this.imageLoader.load(this.images[imageIndexes.targetSpriteIndex])\r\n            .then(function (image) { return _this.drawAngle(image, imageIndexes.targetImageIndex); });\r\n    };\r\n    /**\r\n     * Update the configuration and re-render the hotspots\r\n     *\r\n     * @param {ConfigurationInterface} configuration\r\n     */\r\n    ThreeSixty.prototype.updateConfiguration = function (configuration) {\r\n        this.configuration = configuration;\r\n        this.hotspotElements.forEach(function (hotspotElement) { return hotspotElement.parentElement.removeChild(hotspotElement); });\r\n        this.hotspotElements = [];\r\n        this.initializeHotspots();\r\n    };\r\n    /**\r\n     * Update and re-render the images\r\n     *\r\n     * @param {ImageSetInterface} imageSet\r\n     */\r\n    ThreeSixty.prototype.updateImages = function (imageSet) {\r\n        var _this = this;\r\n        this.imageSet = imageSet;\r\n        this.images = this.getActiveImages();\r\n        var imageIndexes = this.getImageIndexesForCurrentAngle();\r\n        this.imageLoader.load(this.images[imageIndexes.targetSpriteIndex])\r\n            .then(function (image) { return _this.drawAngle(image, imageIndexes.targetImageIndex); });\r\n    };\r\n    /**\r\n     * Preload all images\r\n     *\r\n     * @returns {Promise<null>}\r\n     */\r\n    ThreeSixty.prototype.preload = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            var imagesLoaded = 0;\r\n            /**\r\n             * Preload a single image\r\n             * Resolve the Promise if all images were loaded\r\n             *\r\n             * @param {string} url\r\n             */\r\n            var preloadImage = function (url) {\r\n                _this.imageLoader.load(url)\r\n                    .then(function () {\r\n                    imagesLoaded++;\r\n                    if (imagesLoaded === _this.images.length) {\r\n                        resolve();\r\n                    }\r\n                });\r\n            };\r\n            _this.images.forEach(preloadImage.bind(_this));\r\n        });\r\n    };\r\n    /**\r\n     * Get the active images for the current browser width\r\n     *\r\n     * @returns {string[]}\r\n     */\r\n    ThreeSixty.prototype.getActiveImages = function () {\r\n        var width = window.outerWidth;\r\n        var breakpoints = Object.keys(this.imageSet);\r\n        var activeBreakpoint = breakpoints.sort().reverse().find(function (breakpoint) {\r\n            if (parseFloat(breakpoint) <= width) {\r\n                return true;\r\n            }\r\n        });\r\n        return this.imageSet[activeBreakpoint];\r\n    };\r\n    /**\r\n     * Initialize the hotspots\r\n     */\r\n    ThreeSixty.prototype.initializeHotspots = function () {\r\n        var _this = this;\r\n        if (this.configuration.hotspots) {\r\n            this.configuration.hotspots.forEach(function (hotspot) {\r\n                var hotspotElement = document.createElement('div');\r\n                hotspotElement.classList.add(ThreeSixty.HOTSPOT_CLASS);\r\n                hotspotElement.innerText = hotspot.text;\r\n                if (hotspot.top) {\r\n                    hotspotElement.style.top = hotspot.top;\r\n                }\r\n                if (hotspot.left) {\r\n                    hotspotElement.style.left = hotspot.left;\r\n                }\r\n                _this.hotspotElements.push(hotspotElement);\r\n            });\r\n            this.hotspotElements.forEach(function (hotSpotElement) { return _this.containerElement.appendChild(hotSpotElement); });\r\n            this.showActiveHotspots();\r\n        }\r\n    };\r\n    /**\r\n     * Show the active hotspots\r\n     */\r\n    ThreeSixty.prototype.showActiveHotspots = function () {\r\n        var _this = this;\r\n        if (this.configuration.hotspots) {\r\n            this.configuration.hotspots.forEach(function (hotspot, i) {\r\n                if (hotspot.angle <= _this.angle && hotspot.endAngle >= _this.angle) {\r\n                    _this.hotspotElements[i].classList.add(ThreeSixty.HOTSPOT_ACTIVE_CLASS);\r\n                }\r\n                else {\r\n                    _this.hotspotElements[i].classList.remove(ThreeSixty.HOTSPOT_ACTIVE_CLASS);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * Initialize the event listeners\r\n     */\r\n    ThreeSixty.prototype.initializeEventListeners = function () {\r\n        this.hammer = new Hammer(this.canvasElement);\r\n        this.hammer.get('pan').set({ direction: Hammer.DIRECTION_HORIZONTAL, threshold: 0 });\r\n        this.hammer.on('pan', this.onDrag.bind(this));\r\n        this.hammer.on('panstart', this.onDragStart.bind(this));\r\n    };\r\n    /**\r\n     * Get the target image indexes for the current angle\r\n     */\r\n    ThreeSixty.prototype.getImageIndexesForCurrentAngle = function () {\r\n        var targetImageIndex = Math.round(this.angle / (360 / this.configuration.angles));\r\n        var targetSpriteIndex = Math.floor(targetImageIndex / this.configuration.anglesPerImage);\r\n        return { targetImageIndex: targetImageIndex % this.configuration.anglesPerImage, targetSpriteIndex: targetSpriteIndex };\r\n    };\r\n    /**\r\n     * Draw a specific angle\r\n     *\r\n     * @param {Image} image\r\n     * @param {number} imageIndex\r\n     */\r\n    ThreeSixty.prototype.drawAngle = function (image, imageIndex) {\r\n        var _this = this;\r\n        var loaded = false;\r\n        var _drawAngle = function () {\r\n            _this.canvas2dContext.drawImage(image, 0, -_this.canvasElement.height * imageIndex, _this.canvasElement.width, _this.canvasElement.height * _this.configuration.anglesPerImage);\r\n            if (!loaded) {\r\n                window.requestAnimationFrame(_drawAngle.bind(_this));\r\n                loaded = true;\r\n            }\r\n        };\r\n        window.requestAnimationFrame(_drawAngle.bind(this));\r\n    };\r\n    /**\r\n     * Drag the angle\r\n     *\r\n     * @param {{deltaX: number}} e\r\n     */\r\n    ThreeSixty.prototype.onDrag = function (e) {\r\n        var _this = this;\r\n        // Calculate new image angle\r\n        this.adaptAngle(-e.deltaX);\r\n        var imageIndexes = this.getImageIndexesForCurrentAngle();\r\n        // Load and render new image angle\r\n        this.imageLoader.load(this.images[imageIndexes.targetSpriteIndex])\r\n            .then(function (image) { return _this.drawAngle(image, (imageIndexes.targetImageIndex)); });\r\n        this.showActiveHotspots();\r\n    };\r\n    /**\r\n     * Cache the angle before the drag starts\r\n     */\r\n    ThreeSixty.prototype.onDragStart = function () {\r\n        this.preDragAngle = this.angle;\r\n    };\r\n    /**\r\n     * Recalculate the canvas angle\r\n     *\r\n     * @param {number} distance\r\n     */\r\n    ThreeSixty.prototype.adaptAngle = function (distance) {\r\n        distance = Math.ceil(distance * (this.configuration.speedFactor ? this.configuration.speedFactor : 5));\r\n        var width = window.innerWidth;\r\n        var dx = (distance / width);\r\n        var tmpAngle = ((1 - (this.preDragAngle / 360)) + dx * 1.5);\r\n        while (tmpAngle < 0) {\r\n            tmpAngle++;\r\n        }\r\n        tmpAngle = tmpAngle % 1;\r\n        this.angle = -360 * tmpAngle + 360;\r\n    };\r\n    /**\r\n     * @type {string}\r\n     */\r\n    ThreeSixty.CONTAINER_CLASS = 'three-sixty-container';\r\n    /**\r\n     * @type {string}\r\n     */\r\n    ThreeSixty.HOTSPOT_CLASS = 'three-sixty__hotspot';\r\n    /**\r\n     * @type {string}\r\n     */\r\n    ThreeSixty.HOTSPOT_ACTIVE_CLASS = 'three-sixty__hotspot--active';\r\n    return ThreeSixty;\r\n}());\n\n/**\n * @license angular-three-sixty\n * MIT license\n */\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes} checked by tsc\n */\nvar ThreeSixtyFactory = (function () {\n    function ThreeSixtyFactory() {\n    }\n    /**\n     * @param {?} canvasElement\n     * @param {?} configuration\n     * @return {?}\n     */\n    ThreeSixtyFactory.prototype.create = /**\n     * @param {?} canvasElement\n     * @param {?} configuration\n     * @return {?}\n     */\n    function (canvasElement, configuration) {\n        return new ThreeSixty(canvasElement, configuration);\n    };\n    return ThreeSixtyFactory;\n}());\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes} checked by tsc\n */\nvar ThreeSixtyComponent = (function () {\n    function ThreeSixtyComponent(threeSixtyFactory) {\n        this.threeSixtyFactory = threeSixtyFactory;\n        /**\n         * The initial angle to show (number between 0 and 360)\n         */\n        this.startAngle = 0;\n        /**\n         * Image set with all (ordered) image urls\n         */\n        this.images = {};\n        /**\n         * Flag to control if all images should be preloaded\n         */\n        this.preload = false;\n        /**\n         * Gets emitted when the images were preloaded\n         */\n        this.preloaded = new core.EventEmitter();\n    }\n    /**\n     * @inheritDoc\n     * @return {?}\n     */\n    ThreeSixtyComponent.prototype.ngOnInit = /**\n     * @inheritDoc\n     * @return {?}\n     */\n    function () {\n        this.threeSixty = this.threeSixtyFactory.create(this.canvasElement.nativeElement, this.getThreeSixtyConfiguration());\n        this.threeSixty.initialize(this.images, this.startAngle);\n        this.preloadImages();\n    };\n    /**\n     * @inheritDoc\n     * @param {?} changes\n     * @return {?}\n     */\n    ThreeSixtyComponent.prototype.ngOnChanges = /**\n     * @inheritDoc\n     * @param {?} changes\n     * @return {?}\n     */\n    function (changes) {\n        if (!this.threeSixty) {\n            return;\n        }\n        // Don't update the configuration if only the images have been changed\n        var /** @type {?} */ changedProperties = Object.keys(changes);\n        if (changedProperties.length > 1 || !changes.hasOwnProperty('images')) {\n            this.threeSixty.updateConfiguration(this.getThreeSixtyConfiguration());\n        }\n        if (changes.hasOwnProperty('images')) {\n            this.threeSixty.updateImages(this.images);\n            this.preloadImages();\n        }\n    };\n    /**\n     * Force a preload of all images\n     * @return {?}\n     */\n    ThreeSixtyComponent.prototype.forcePreload = /**\n     * Force a preload of all images\n     * @return {?}\n     */\n    function () {\n        var _this = this;\n        this.threeSixty.preload().then(function () { return _this.preloaded.emit(); });\n    };\n    /**\n     * Preload all images if the preload flag is set\n     * @return {?}\n     */\n    ThreeSixtyComponent.prototype.preloadImages = /**\n     * Preload all images if the preload flag is set\n     * @return {?}\n     */\n    function () {\n        var _this = this;\n        if (this.preload) {\n            this.threeSixty.preload().then(function () { return _this.preloaded.emit(); });\n        }\n    };\n    /**\n     * Get the configuration object for the ThreeSixty instance\n     * @return {?}\n     */\n    ThreeSixtyComponent.prototype.getThreeSixtyConfiguration = /**\n     * Get the configuration object for the ThreeSixty instance\n     * @return {?}\n     */\n    function () {\n        var /** @type {?} */ configuration = {\n            angles: this.angles,\n            anglesPerImage: this.anglesPerImage\n        };\n        if (this.speedFactor >= 0) {\n            configuration.speedFactor = this.speedFactor;\n        }\n        if (this.hotspots) {\n            configuration.hotspots = this.hotspots;\n        }\n        return configuration;\n    };\n    ThreeSixtyComponent.decorators = [\n        { type: core.Component, args: [{\n                    selector: 'mm-three-sixty',\n                    styles: ['.three-sixty-container{position:relative;cursor:move;cursor:-webkit-grab;-ms-touch-action:none;touch-action:none}.three-sixty__hotspot{display:none;position:absolute;width:200px;padding:10px 15px;background:rgba(0,0,0,.5);border-radius:20px;color:#fff}.three-sixty__hotspot--active{display:block}'],\n                    template: \"<canvas #canvasElement class=\\\"mm-three-sixty\\\" [width]=\\\"width\\\" [height]=\\\"height\\\"></canvas>\",\n                    encapsulation: core.ViewEncapsulation.None\n                },] },\n    ];\n    /** @nocollapse */\n    ThreeSixtyComponent.ctorParameters = function () { return [\n        { type: ThreeSixtyFactory, },\n    ]; };\n    ThreeSixtyComponent.propDecorators = {\n        \"width\": [{ type: core.Input },],\n        \"height\": [{ type: core.Input },],\n        \"angles\": [{ type: core.Input },],\n        \"anglesPerImage\": [{ type: core.Input },],\n        \"startAngle\": [{ type: core.Input },],\n        \"images\": [{ type: core.Input },],\n        \"speedFactor\": [{ type: core.Input },],\n        \"hotspots\": [{ type: core.Input },],\n        \"preload\": [{ type: core.Input },],\n        \"preloaded\": [{ type: core.Output },],\n        \"canvasElement\": [{ type: core.ViewChild, args: ['canvasElement',] },],\n    };\n    return ThreeSixtyComponent;\n}());\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes} checked by tsc\n */\nvar ThreeSixtyModule = (function () {\n    function ThreeSixtyModule() {\n    }\n    ThreeSixtyModule.decorators = [\n        { type: core.NgModule, args: [{\n                    declarations: [ThreeSixtyComponent],\n                    providers: [ThreeSixtyFactory],\n                    exports: [ThreeSixtyComponent]\n                },] },\n    ];\n    /** @nocollapse */\n    ThreeSixtyModule.ctorParameters = function () { return []; };\n    return ThreeSixtyModule;\n}());\n\nexports.ThreeSixtyModule = ThreeSixtyModule;\nexports.ThreeSixtyComponent = ThreeSixtyComponent;\nexports.ɵa = ThreeSixtyFactory;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=angular-three-sixty.umd.js.map\n"]}